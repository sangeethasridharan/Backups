<html>
  <head>
    <meta http-equiv="content-type" content="	text/html; charset=UTF-8">
    
    <title>View</title>
    
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

<!-- Optional theme -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script> 
<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
   


    <script type="text/javascript">
    var request; 
    var str;
    var title; 
    var names,nameslist,divt,link;
    function displayfunc() {
    	
    	
    	if(window.XMLHttpRequest){ 
    		
    		request=new XMLHttpRequest();  
    		 
            request.open('GET', 'https://randomuser.me/api/?results=1&&inc=gender,name&noinfo');
            request.onload = function() {
                if (request.status === 200) {
                	 str= request.responseText;
                	 request.onreadystatechange=getInfo(); 
                	 document.getElementById('process').innerHTML= str;
                	 
                }
                else {
                    alert('Request failed.  Returned status of ' + request.status);
                }
            };
            request.send();
            
    	}  
    	else {
    		if(window.ActiveXObject){  
    	
    		request=new ActiveXObject("Microsoft.XMLHTTP");  
    	}  
    	}
    	
    } 	
    
    function getInfo(){  
    	if(request.readyState==4){    
    	//postInfo(str); 
    	document.getElementById('alert').innerHTML="Do you want to save this contact...";
    	//postInfo(str);
    	} 
    }	
    
    
    function postInfo()
    {
    	var req = new XMLHttpRequest;
    	var jsonStr={};
    	//title= document.getElementById('ti').value;
        	  req.open("POST","servlet",true);
              req.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
              jsonStr=document.getElementById('process').innerHTML;
        	  
        	  
        	  req.onreadystatechange = function() {
              	
          	    if (this.readyState == 4 && this.status == 200) {
          		alert("Contacts Saved successfully");
          		document.getElementById('names').innerHTML = this.responseText;
          		
          	    }
          	  };
          	req.send(jsonStr);
          	
      }
    
    
    function search()
    {
    	
    	var v = document.getElementById('se').value;
    	var searchReq = new XMLHttpRequest();
    	var url="/search?val="+v;
    	var fname;
    	searchReq.open("GET",url,true);
    	
		
    	searchReq.onload = function() {
    		
    		if (this.readyState == 4 && this.status !=200){
    			alert("you are wrong");
    		}
    		
    		else if (this.readyState == 4 && this.status == 200) {
    	    	alert("Result");
    	    	name = searchReq.responseText;
    	    	if(name != "Not Available")
	    		{
    	    	var data=JSON.parse(name);
    	    	
    	    	var title = data[0].title;
    	    	var fname = data[0].first;
    	    	var lname = data[0].last;
    	    	
    	    	      document.getElementById("err").style.visibility='hidden';
    	    		  document.getElementById("form").style.visibility='visible';
    				  document.getElementById('ti').innerHTML=title;
    				  document.getElementById('fn').innerHTML=fname;
    				  document.getElementById('ln').innerHTML=lname;
    				  
    	    		}
    			else
    				{
    				  document.getElementById("err").style.visibility='visible';
    				  document.getElementById('err').innerHTML= name;
    				}
    	    }
    	  };
    	  
    	searchReq.send();
    }
    
    
    function show()
    {
    	var showReq = new XMLHttpRequest();
    	var url="/show";
        showReq.open("GET",url,true);
    	var contacts;
		
    	showReq.onload = function() {
    		
    		if (this.readyState == 4 && this.status !=200){
    			alert("you are wrong");
    		}
    		
    		else if (this.readyState == 4 && this.status == 200) {
    			contacts = showReq.responseText;
    			names=JSON.parse(contacts);
    		    alert(contacts);
    			var i;
    			
    			document.getElementById('list').innerHTML = '';
    				for(i=0;i<names.length;i++)
    					{
    					document.getElementById("dthc").style.visibility='visible'
    				    	divt = document.createElement("div");
    				    	
    				    	link = document.createElement("a");
    				    	link.setAttribute('id',`na${i}`);
    				    	
        				    nameslist = document.createTextNode(names[i].first);
        				   
        				    
        				    link.setAttribute('onclick', 'details(names,\"'+names[i].first+'\")');
        				    link.appendChild(nameslist);
        				    divt.appendChild(link);
        				    
        				    
        				    document.getElementById("list").appendChild(divt).style.fontSize='20px';
        				    
    					}	
    				
    				
    		}
    	};
    	showReq.send();
    	
    }
    
    function details(names,name)
    {
      for(var j=0;j<names.length;j++)
    	  {
    	  if(name == names[j].first)
    		  {
    		  document.getElementById("dth").style.visibility='visible';
    		  document.getElementById("dtd").style.visibility='visible';
    		  document.getElementById("tit").disabled=true;
    		  document.getElementById("tit").value = names[j].title;
    		  document.getElementById("fna").disabled=true;
    		  document.getElementById("fna").value = names[j].first;
    		  document.getElementById("lna").disabled=true;
    		  document.getElementById("lna").value = names[j].last;
              
    		  }
    	  }
      
    }
    
    function updatevalues()
    {
    	
        
        
        	document.getElementById("tit").disabled=false;
        	
        	document.getElementById("lna").disabled=false;
        	
        	document.getElementById("ubtn").style="visibility:hidden";
        	
        	document.getElementById("ubtn1").style="visibility:visible";
        	
        	
        	
     }
    function update()
    {
    	var updateReq = new XMLHttpRequest();
    	updateReq.open("PUT","/update",true);
        updateReq.setRequestHeader("Content-Type", "application/json; charset=utf-8");
        
        tid = document.getElementById("tit").value;
    	fnamed = document.getElementById("fna").value;
    	lnamed = document.getElementById("lna").value;
    	
    	var values = {};
    	values.title = tid;
    	values.first = fnamed;
    	values.last = lnamed;
     	var jstr = JSON.stringify(values);
     	
     	updateReq.onreadystatechange = function() {
        	if (this.readyState == 4 && this.status == 200) {
        		alert(this.responseText);
        		
        		document.getElementById("tit").disabled=true;
            	
            	document.getElementById("lna").disabled=true;
            	
        		document.getElementById("ubtn").style="visibility:visible";
            	
            	document.getElementById("ubtn1").style="visibility:hidden";
        	}
    	
        };
        updateReq.send(jstr);
        
    }
    
    function deleteconc()
    {
    	
    	var deleteReq = new XMLHttpRequest();
    	deleteReq.open("DELETE","/delete",true);
        deleteReq.setRequestHeader("Content-Type", "application/json; charset=utf-8");
    	
        var fnames = document.getElementById("fna").value;
    	deleteReq.onreadystatechange = function() {
        	if (this.readyState == 4 && this.status == 200) {
        		var nameList = this.responseText;
        		var contactList = JSON.parse(nameList);
        		alert(nameList);
        		
        		}
        	};
        	
    	deleteReq.send(fnames);
    	
    }
    </script>
  </head>

  <body>
  
    <h3><span class="label label-default">CONTACTS</span></h3>
    
        
        <form>
        <p id="process"></p>
        
        <p id="names"></p>
        
        
        <button type="button"  onClick="displayfunc()">New Contacts </button><br>
        <span id="alert"></span>
        
        <button type="button"  onClick="postInfo()">Save </button><br>
        <h1>SearchName</h1>
        Enter name to Search<input type="text" id = "se" >
        <input type=button onclick="search()" value="SearchName">
        
        <input type=button onClick="show()" value="Show Contacts">
        
        <p id="test"></p>
 
        <table class="table" align="center">
        <tr>
        <th id="dthc" style="visibility:hidden">Contacts</th>
        
        <th id="dth" align="right" style="visibility:hidden">Details</th>
        </tr>
        <tr>
        <td>
        <p id="list"></p>
        </td>
        
        <td id="dtd" style="visibility:hidden">
        <label><h4>Title :</h4></label>
        <input type="text" id="tit"/><br>
        <label><h4>FirstName :</h4></label>
        <input type="text" id="fna"/><br>
        <label><h4>LastName :</h4></label>
        <input type="text" id="lna"/><br>
        
        <input type="button" value="UPDATE" onClick="updatevalues()" id="ubtn"/>
        <input type="button" value="SUBMIT" onClick="update()" id="ubtn1" style="visibility:hidden"/>
        <input type="button" value="DELETE" onClick="deleteconc()"/>
        </td>
        </tr>
        </table>
        
        </form>
        <span id="err" style="visibility:hidden"></span>
        <form id="form" style="visibility:hidden">
        <h1>DETAILS</h1>
        <label><h4>Title :</h4></label>
        <label id="ti"></label><br>
        <label><h4>FirstName :</h4></label>
        <label id="fn"></label><br>
        <label><h4>LastName :</h4></label>
        <label id="ln"></label>
        </form>
  </body>
</html>
